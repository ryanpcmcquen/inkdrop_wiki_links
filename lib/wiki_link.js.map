{"version":3,"sources":["../src/wiki_link.js"],"names":["db","inkdrop","main","dataStore","getLocalDB","createRemarkWikiLink","OriginalSpan","WikiLink","props","link","children","attributes","onClick","event","preventDefault","stopPropagation","isMobile","commands","dispatch","document","body","keyword","utils","search","then","note","noteToOpenId","isNewNote","docs","length","_id","editingNote","store","getState","notes","createId","put","bookId","doctype","_rev","undefined","title","createdAt","Date","now","updatedAt","noteId","renderError","error","message","e"],"mappings":";AAAA;;;;;;;AACA;;;;;;;;;;;;;;AAEA,MAAMA,EAAE,GAAGC,OAAO,iBAAIA,OAAJ,8DAAI,SAASC,IAAb,2EAAI,cAAeC,SAAnB,0DAAI,sBAA0BC,UAA1B,EAAJ,CAAlB;;AAEA,MAAMC,oBAAoB,GAAIC,YAAD,IAAkB;AAC3C,QAAMC,QAAQ,GAAIC,KAAD,IAAW;AACxB,UAAMC,IAAI,GAAGD,KAAK,CAACE,QAAN,CAAe,CAAf,CAAb;;AAEA,QAAID,IAAJ,EAAU;AACN,UAAI;AACA,cAAME,UAAU;AACZ;AACAC,UAAAA,OAAO,EAAGC,KAAD,IAAW;AAChBA,YAAAA,KAAK,CAACC,cAAN;AACAD,YAAAA,KAAK,CAACE,eAAN;;AAEA,gBAAId,OAAO,CAACe,QAAZ,EAAsB;AAClBf,cAAAA,OAAO,CAACgB,QAAR,CAAiBC,QAAjB,CACIC,QAAQ,CAACC,IADb,EAEI,mBAFJ,EAGI;AAAEC,gBAAAA,OAAO,EAAG,SAAQZ,IAAK;AAAzB,eAHJ;AAKH,aAND,MAMO,IAAIT,EAAJ,EAAQ;AACXA,cAAAA,EAAE,CAACsB,KAAH,CAASC,MAAT,CAAiB,SAAQd,IAAK,EAA9B,EAAiCe,IAAjC,CAAuCC,IAAD,IAAU;AAC5C,oBAAIC,YAAJ;AACA,oBAAIC,SAAJ;;AACA,oBAAIF,IAAI,SAAJ,IAAAA,IAAI,WAAJ,IAAAA,IAAI,CAAEG,IAAN,IAAcH,IAAI,CAACG,IAAL,CAAUC,MAAV,GAAmB,CAArC,EAAwC;AACpCH,kBAAAA,YAAY,GAAGD,IAAI,CAACG,IAAL,CAAU,CAAV,EAAaE,GAA5B;AACAH,kBAAAA,SAAS,GAAG,KAAZ;AACH,iBAHD,MAGO;AACH,wBAAM;AACFI,oBAAAA;AADE,sBAEF9B,OAAO,CAAC+B,KAAR,CAAcC,QAAd,EAFJ;AAGAP,kBAAAA,YAAY,GAAG1B,EAAE,CAACkC,KAAH,CAASC,QAAT,EAAf;AACAnC,kBAAAA,EAAE,CAACkC,KAAH,CAASE,GAAT,CAAa;AACTC,oBAAAA,MAAM,EAAEN,WAAW,CAACM,MADX;AAETC,oBAAAA,OAAO,EAAEP,WAAW,CAACO,OAFZ;AAGTR,oBAAAA,GAAG,EAAEJ,YAHI;AAITa,oBAAAA,IAAI,EAAEC,SAJG;AAKTpB,oBAAAA,IAAI,EAAE,EALG;AAMTqB,oBAAAA,KAAK,EAAEhC,IANE;AAOTiC,oBAAAA,SAAS,EAAEC,IAAI,CAACC,GAAL,EAPF;AAQTC,oBAAAA,SAAS,EAAEF,IAAI,CAACC,GAAL;AARF,mBAAb;AAUAjB,kBAAAA,SAAS,GAAG,IAAZ;AACH;;AACD1B,gBAAAA,OAAO,CAACgB,QAAR,CAAiBC,QAAjB,CACIC,QAAQ,CAACC,IADb,EAEI,gBAFJ,EAGI;AAAE0B,kBAAAA,MAAM,EAAEpB;AAAV,iBAHJ;;AAKA,oBAAIC,SAAJ,EAAe;AACX1B,kBAAAA,OAAO,CAACgB,QAAR,CAAiBC,QAAjB,CACIC,QAAQ,CAACC,IADb,EAEI,qBAFJ;AAIH;;AACDnB,gBAAAA,OAAO,CAACgB,QAAR,CAAiBC,QAAjB,CACIC,QAAQ,CAACC,IADb,EAEI,cAFJ;AAIH,eAtCD;AAuCH;;AAED,mBAAO,KAAP;AACH,WAvDW;AAwDZ2B,UAAAA,WAAW,EAAGC,KAAD,IAAW;AACpB,gCACI;AAAM,cAAA,SAAS,EAAC;AAAhB,eACKA,KAAK,CAACC,OADX,CADJ;AAKH;AA9DW,WA+DTzC,KA/DS,CAAhB;;AAiEA,YAAIF,YAAJ,EAAkB;AACd,8BACI,oBAAC,YAAD,EAAkBE,KAAlB,EAA0BA,KAAK,CAACE,QAAhC,CADJ;AAGH,SAJD,MAIO;AACH,8BAAO,4BAAUC,UAAV,EAAuBF,IAAvB,CAAP;AACH;AACJ,OAzED,CAyEE,OAAOyC,CAAP,EAAU;AACR,4BAAO,kCAAOA,CAAC,CAACD,OAAT,CAAP;AACH;AACJ,KA7ED,MA6EO;AACH,0BAAO,sDAAP;AACH;AACJ,GAnFD;;AAqFA,SAAO1C,QAAP;AACH,CAvFD;;eAyFeF,oB","sourcesContent":["\"use babel\";\nimport * as React from \"react\";\n\nconst db = inkdrop && inkdrop?.main?.dataStore?.getLocalDB();\n\nconst createRemarkWikiLink = (OriginalSpan) => {\n    const WikiLink = (props) => {\n        const link = props.children[0];\n\n        if (link) {\n            try {\n                const attributes = {\n                    // href: `inkdrop://note/${link}`,\n                    onClick: (event) => {\n                        event.preventDefault();\n                        event.stopPropagation();\n\n                        if (inkdrop.isMobile) {\n                            inkdrop.commands.dispatch(\n                                document.body,\n                                \"core:search-notes\",\n                                { keyword: `title:${link}` }\n                            );\n                        } else if (db) {\n                            db.utils.search(`title:${link}`).then((note) => {\n                                let noteToOpenId;\n                                let isNewNote;\n                                if (note?.docs && note.docs.length > 0) {\n                                    noteToOpenId = note.docs[0]._id;\n                                    isNewNote = false;\n                                } else {\n                                    const {\n                                        editingNote,\n                                    } = inkdrop.store.getState();\n                                    noteToOpenId = db.notes.createId();\n                                    db.notes.put({\n                                        bookId: editingNote.bookId,\n                                        doctype: editingNote.doctype,\n                                        _id: noteToOpenId,\n                                        _rev: undefined,\n                                        body: \"\",\n                                        title: link,\n                                        createdAt: Date.now(),\n                                        updatedAt: Date.now(),\n                                    });\n                                    isNewNote = true;\n                                }\n                                inkdrop.commands.dispatch(\n                                    document.body,\n                                    \"core:open-note\",\n                                    { noteId: noteToOpenId }\n                                );\n                                if (isNewNote) {\n                                    inkdrop.commands.dispatch(\n                                        document.body,\n                                        \"view:toggle-preview\"\n                                    );\n                                }\n                                inkdrop.commands.dispatch(\n                                    document.body,\n                                    \"editor:focus\"\n                                );\n                            });\n                        }\n\n                        return false;\n                    },\n                    renderError: (error) => {\n                        return (\n                            <span className=\"ui error message mde-error-message\">\n                                {error.message}\n                            </span>\n                        );\n                    },\n                    ...props,\n                };\n                if (OriginalSpan) {\n                    return (\n                        <OriginalSpan {...props}>{props.children}</OriginalSpan>\n                    );\n                } else {\n                    return <span {...attributes}>{link}</span>;\n                }\n            } catch (e) {\n                return <span>{e.message}</span>;\n            }\n        } else {\n            return <span>Invalid Wiki Link</span>;\n        }\n    };\n\n    return WikiLink;\n};\n\nexport default createRemarkWikiLink;\n"],"file":"wiki_link.js"}